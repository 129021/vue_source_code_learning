{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observer {\r\n    constructor(data) {\r\n        // 要把data中的每个属性都劫持，但是Object.defineProperty只能劫持已经存在的属性，后增的或者删除的，不知道（vue会为此单独写一些API，比如$set,$delete)\r\n\r\n\r\n        if (Array.isArray(data)) { // 如果属性是数组的话，就不要循环遍历来劫持了\r\n            // 要监控用户有没有调数组的方法，要重写数组的方法 要修改数组的7个变异方法（变异方法即可以修改数组本身）\r\n\r\n            // 我们希望保留数组原有的特性，并且重写部分方法\r\n            data.__proto__ = {\r\n                push() {\r\n                    console.log('重写了push方法');\r\n                },\r\n\r\n            }\r\n\r\n\r\n\r\n\r\n            this.observeArray(data) //如果数组中有属性值为对象，则对象可以监控到\r\n        } else {\r\n            // 如果不是数组的话，就循环遍历来劫持\r\n            this.walk(data)\r\n        }\r\n\r\n    }\r\n\r\n    walk(data) {\r\n        // 循环对象，对属性依次劫持\r\n\r\n        // 重新定义属性\r\n        Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\r\n    }\r\n\r\n\r\n    observeArray(data) { //观测数组，看看数组内有没有对象\r\n\r\n        data.forEach(item => observe(item))\r\n\r\n    }\r\n}\r\n\r\nexport function defineReactive(target, key, value) { //defineReactive是一个闭包，get和set方法都能拿到value，value不会被销毁\r\n\r\n    observe(value) //使用递归对所有的对象都进行属性劫持，不管你是嵌套几层的对象\r\n\r\n    Object.defineProperty(target, key, {\r\n        // 取值的时候，执行get\r\n        get() {\r\n            console.log('取值了');\r\n            console.log('key:', key);\r\n            return value\r\n        },\r\n\r\n\r\n        // 修改的时候，执行set\r\n        set(newValue) {\r\n            console.log('修改值了');\r\n            if (newValue === value) return\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n\r\n\r\n    // 对这个对象进行劫持\r\n    if (typeof data !== 'object' || data == null) {\r\n        return //只对对象进行劫持\r\n    }\r\n\r\n\r\n    // 如果一个对象被劫持过了，那就不需要再被劫持了（要判断一个对象是否被劫持过，可以增添一个实例，用实例来判断是否被劫持过\r\n    return new Observer(data)\r\n\r\n}","// 此文件专门用于状态初始化\r\n\r\nimport {\r\n    observe\r\n} from \"./observe/index\";\r\n\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options //获取所有的选项\r\n\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n\r\n    // if(opts.props){\r\n    //     initProps()\r\n    // }\r\n\r\n\r\n}\r\n\r\n\r\nfunction proxy(vm, target, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[target][key] //例如返回vm._data.name\r\n        },\r\n\r\n        set(newValue) {\r\n            vm[target][key] = newValue\r\n        }\r\n    })\r\n\r\n\r\n}\r\n\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data; //data可能是函数，也可能是对象\r\n\r\n    data = typeof data === 'function' ? data.call(vm) : data //data是用户返回的对象\r\n\r\n\r\n    console.log(data);\r\n\r\n\r\n    vm._data = data //我将返回的对象放在了_data上\r\n\r\n    //    对数据进行劫持\r\n    // Vue2里面采用了一个 API Object.defineProperty\r\n    observe(data)\r\n\r\n    // 将vm._data用vm来代理了\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key)\r\n\r\n    }\r\n\r\n}","import { initState } from \"./state\";\r\n\r\n// 此函数用于Vue的初始化操作\r\n// 专门用于初始化\r\n\r\n\r\n// 这是用于给Vue增加init方法\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n\r\n\r\n\r\n        // vue 的实例 vm身上有一个 vm.$options 就是获取用户的配置\r\n        // this.$options=options\r\n        // 这里不用this，而是用vm\r\n        const vm = this;\r\n        vm.$options = options; //将用户的选项挂载到实例上\r\n\r\n\r\n        // 初始化状态（包括props，data，computed，watch等）\r\n        initState(vm)\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n// function initState(vm) {\r\n//     const opts = vm.$options //获取所有的选项\r\n\r\n//     if (opts.data) {\r\n//         initData(vm)\r\n//     }\r\n\r\n//     // if(opts.props){\r\n//     //     initProps()\r\n//     // }\r\n\r\n\r\n// }\r\n\r\n\r\n\r\n// function initData(vm) {\r\n//     let data = vm.$options.data; //data可能是函数，也可能是对象\r\n\r\n//    data= typeof data === 'function' ? data.call(vm) : data \r\n\r\n\r\n//    console.log(data);\r\n\r\n\r\n// }","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue); //扩展了Init方法\r\nexport default Vue"],"names":["Observer","data","Array","isArray","__proto__","push","console","log","observeArray","walk","Object","keys","forEach","key","defineReactive","item","observe","target","value","defineProperty","get","set","newValue","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}